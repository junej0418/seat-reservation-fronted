<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ëœì„ ì„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
<style>
  /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
  body {
    font-family: 'Malgun Gothic', Arial, sans-serif;
    margin: 0; padding: 0;
    background: #fafafc;
    color: #2c3e50;
  }
  h1, h2 {
    text-align: center;
    margin: 1em 0;
    color: #334155;
  }
  .container {
    max-width: 900px;
    margin: 15px auto 40px;
    background: white;
    padding: 25px 30px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.06);
  }
  .hidden { display: none; }

  /* í¼ ìš”ì†Œ */
  form {
    max-width: 400px;
    margin: 0 auto;
  }
  label {
    font-weight: 700;
    margin-top: 1.2em;
    display: block;
    color: #475569;
  }
  input[type=text], input[type=password], input[type=datetime-local], select {
    width: 100%;
    padding: 10px 12px;
    margin-top: 6px;
    font-size: 1rem;
    border: 2px solid #cbd5e1;
    border-radius: 8px;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
  }
  input[type=text]:focus, input[type=password]:focus, input[type=datetime-local]:focus, select:focus {
    border-color: #fbbf24;
    outline: none;
  }
  .error {
    color: #dc2626;
    font-size: 0.9em;
    height: 20px;
    margin-top: 4px;
  }

  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  button {
    background-color: #fbbf24;
    border: none;
    border-radius: 8px;
    padding: 12px 25px;
    font-size: 1.1rem;
    font-weight: 700;
    color: #92400e;
    cursor: pointer;
    margin-top: 1.5em;
    box-shadow: 1px 3px 6px rgba(251,191,36,0.5);
    transition: background-color 0.3s ease;
    display: inline-block; /* ì¶”ê°€: ê°€ë¡œ ì •ë ¬ ë° ê³µê°„ í™œìš© */
  }
  button:hover:not(:disabled) {
    background-color: #f59e0b;
  }
  button:disabled {
    background-color: #fde68a;
    cursor: not-allowed;
    box-shadow: none;
  }
  nav {
    text-align: center;
    margin-top: 2em;
  }
  nav button {
    background: transparent;
    color: #b45309;
    font-weight: 600;
    padding: 8px 16px;
    border: 2px solid #fbbf24;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  nav button:hover {
    background-color: #fbbf24;
    color: #92400e;
  }

  /* ì¢Œì„ ë°°ì¹˜ë„ ì˜ì—­ */
  #seatMap {
    margin: 20px auto 40px;
    display: grid;
    gap: 8px;
    justify-content: center;
  }
  .seat-btn {
    background: #fef3c7;
    border: 2px solid #fbbf24;
    border-radius: 6px;
    font-weight: 700;
    color: #92400e;
    cursor: pointer;
    user-select: none;
    text-align: center;
    font-size: 1.1rem;
    min-width: 44px;
    transition: background-color 0.3s ease, border-color 0.3s ease;

    /* ë„¤ëª¨ ì•ˆ ìˆ«ì ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•œ Flexbox ì†ì„± ì¶”ê°€ */
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .seat-btn:hover:not(.booked) {
    background-color: #fde68a;
    border-color: #fbbf24;
  }
  .seat-btn.booked {
    background: #d1d5db;
    color: #6b7280;
    cursor: not-allowed;
    box-shadow: none;
  }
  .seat-btn.mine {
    background: #fef08a;
    border-color: #ca8a04;
    font-weight: 800;
  }
  .seat-btn.empty {
    visibility: hidden;
    pointer-events: none;
  }

  /* ê´€ë¦¬ì í˜ì´ì§€ í…Œì´ë¸” */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 1rem;
  }
  th, td {
    border: 1px solid #cbd5e1;
    padding: 8px 12px;
    text-align: center;
  }
  th {
    background-color: #fbbf24;
    color: #92400e;
  }
  td button {
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 6px 12px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  td button:hover {
    background: #b91c1c;
  }

  /* ì˜ˆì•½ ì‹œê°„ ì•ˆë‚´ ë©”ì‹œì§€ */
  #reservationAvailabilityMessage {
    text-align: center;
    font-weight: 700;
    margin-top: 1em;
    padding: 0.5em;
    border-radius: 5px;
    color: #ef4444; /* ê¸°ë³¸ì€ ë¹¨ê°„ìƒ‰ (ì˜ˆì•½ ë¶ˆê°€) */
    background-color: #fee2e2;
  }
  #reservationAvailabilityMessage.available {
    color: #10b981; /* ì˜ˆì•½ ê°€ëŠ¥ ì‹œ ì´ˆë¡ìƒ‰ */
    background-color: #d1fae5;
  }

  /* ê´€ë¦¬ì ì„¤ì • ë©”ì‹œì§€ */
  #timeSettingMessage {
    text-align: center;
    margin-top: 10px;
    font-size: 0.9em;
    min-height: 1.5em; /* ë©”ì‹œì§€ ì˜ì—­ í™•ë³´ */
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 600px) {
    .container {
      margin: 10px 15px 30px;
      padding: 20px;
    }
    #seatMap {
      gap: 6px;
    }
    .seat-btn {
      padding: 10px 8px;
      font-size: 1rem;
      min-width: 36px;
    }
  }
</style>
</head>
<body>

<!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
<div class="container" id="loginPage">
  <h1>ëœì„ ì„ ì˜ˆì•½ ë¡œê·¸ì¸</h1>
  <form id="loginForm" autocomplete="off">
    <label for="roomNo">ë£¸ ë²ˆí˜¸ (000í˜¸ í˜•ì‹):</label>
    <input type="text" id="roomNo" name="roomNo" placeholder="ì˜ˆ: 101í˜¸" />
    <div id="roomError" class="error"></div>

    <label for="userName">ì´ë¦„ (í•œê¸€ 2~4ì):</label>
    <input type="text" id="userName" name="userName" placeholder="ì˜ˆ: í™ê¸¸ë™" />
    <div id="nameError" class="error"></div>

    <label for="dormitory">ê¸°ìˆ™ì‚¬ ì„ íƒ:</label>
    <select id="dormitory" name="dormitory">
      <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
      <option value="ê¿ˆë™">ê¿ˆë™</option>
      <option value="ë¯¸ë˜ë™">ë¯¸ë˜ë™</option>
    </select>
    <div id="dormError" class="error"></div>

    <button type="submit">ë‹¤ìŒ</button>
  </form>
  <nav>
    <button id="adminLoginBtn">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
  </nav>
</div>

<!-- ì¸µ ì„ íƒ í˜ì´ì§€ -->
<div class="container hidden" id="floorSelectPage">
  <h2><span id="welcomeText"></span></h2>
  <label for="floorSelect">ì˜ˆì•½í•  ì¸µì„ ì„ íƒí•˜ì„¸ìš”:</label>
  <select id="floorSelect">
    <option value="" disabled selected>ì¸µ ì„ íƒ</option>
  </select>
  <button id="floorNextBtn">ì¢Œì„ ì„ íƒìœ¼ë¡œ</button>
  <button id="backToLoginBtn">ë’¤ë¡œê°€ê¸°</button>
</div>

<!-- ì¢Œì„ ì„ íƒ í˜ì´ì§€ -->
<div class="container hidden" id="seatMapPage">
  <h2>ì¢Œì„ ë°°ì¹˜ë„ - <span id="selectedDorm"></span> <span id="selectedFloor"></span>ì¸µ</h2>
  <div id="seatMap"></div>
  <div id="reservationAvailabilityMessage"></div>
  <button id="confirmBtn" disabled>ì˜ˆì•½ í™•ì •</button>
  <button id="cancelSeatBtn">ì·¨ì†Œ ë° ë’¤ë¡œê°€ê¸°</button>
</div>

<!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ -->
<div class="container hidden" id="adminLoginPage">
  <h1>ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
  <form id="adminLoginForm" autocomplete="off">
    <label for="adminPassword">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:</label>
    <input type="password" id="adminPassword" name="adminPassword" />
    <div id="adminError" class="error"></div>
    <button type="submit">ë¡œê·¸ì¸</button>
  </form>
  <button id="adminLoginBackBtn">ë’¤ë¡œê°€ê¸°</button>
</div>

<!-- ê´€ë¦¬ì í˜ì´ì§€ -->
<div class="container hidden" id="adminPage">
  <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
  <button id="adminLogoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

  <hr style="margin: 2em 0;">

  <h2>ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ì„¤ì •</h2>
  <form id="reservationTimeForm">
    <label for="resStartTime">ì˜ˆì•½ ì‹œì‘ ì‹œê°„:</label>
    <input type="datetime-local" id="resStartTime" />
    <label for="resEndTime">ì˜ˆì•½ ì¢…ë£Œ ì‹œê°„:</label>
    <input type="datetime-local" id="resEndTime" />
    <button type="submit" id="saveTimeSettingsBtn">ì‹œê°„ ì„¤ì • ì €ì¥</button>
    <div id="timeSettingMessage"></div>
  </form>

  <hr style="margin: 2em 0;">

  <h2>ì˜ˆì•½ í˜„í™©</h2>
  <table>
    <thead>
      <tr>
        <th>ì´ë¦„</th>
        <th>ë£¸ ë²ˆí˜¸</th>
        <th>ê¸°ìˆ™ì‚¬</th>
        <th>ì¸µ</th>
        <th>ìë¦¬ ë²ˆí˜¸</th>
        <th>ì˜ˆì•½ ì·¨ì†Œ</th>
      </tr>
    </thead>
    <tbody id="reservationListBody"></tbody>
  </table>
</div>

<!-- Socket.IO í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<!-- ì´ ìŠ¤í¬ë¦½íŠ¸ srcëŠ” ë°±ì—”ë“œ ì„œë²„ì˜ ì‹¤ì œ ì£¼ì†Œì— ë§ì¶°ì ¸ì•¼ í•©ë‹ˆë‹¤. -->
<!-- í˜„ì¬ ë¡œì»¬ ê°œë°œ í™˜ê²½ì„ ê°€ì •í•˜ì—¬ http://localhost:3000ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. -->
<!-- ë§Œì•½ ë°±ì—”ë“œë¥¼ 'https://your-backend-url.com'ì— ë°°í¬í–ˆë‹¤ë©´, ì•„ë˜ srcë„ ê·¸ ì£¼ì†Œë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤. -->
<script src="http://localhost:3000/socket.io/socket.io.js"></script>

<script>
(() => {
  // *** ì¤‘ìš”: ë°±ì—”ë“œ ì„œë²„ URL ì„¤ì • ***
  // í”„ë¡ íŠ¸ì—”ë“œê°€ ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë°±ì—”ë“œ URLì„ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
  const getBackendUrl = (backendPort = 3000) => {
    const protocol = window.location.protocol; // í˜„ì¬ í˜ì´ì§€ì˜ í”„ë¡œí† ì½œ (http:, https:, file:)
    const host = window.location.hostname;     // í˜„ì¬ í˜ì´ì§€ì˜ í˜¸ìŠ¤íŠ¸ (localhost, 127.0.0.1, ë˜ëŠ” ì‹¤ì œ IP)

    // ì›¹ ì„œë²„ (Live Server í¬í•¨)ë¥¼ í†µí•´ ì—´ì—ˆì„ ê²½ìš° (http: ë˜ëŠ” https:)
    if (protocol.startsWith('http')) {
        // í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œ í˜¸ìŠ¤íŠ¸ì™€ ë™ì¼í•œ í˜¸ìŠ¤íŠ¸, ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë°±ì—”ë“œ ì—°ê²° ì‹œë„
        return `${protocol}//${host}:${backendPort}`;
    }
    // HTML íŒŒì¼ì„ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ(file://)ì—ì„œ ì§ì ‘ ì—´ì—ˆì„ ê²½ìš°
    else if (protocol === 'file:') {
        // file:// í”„ë¡œí† ì½œì—ì„œëŠ” originì´ 'null'ë¡œ ì¸ì‹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        // ë°±ì—”ë“œëŠ” ì£¼ë¡œ http://localhostì—ì„œ ì‹¤í–‰ëœë‹¤ê³  ê°€ì •í•˜ê³  ì—°ê²° ì‹œë„.
        // ë°±ì—”ë“œì˜ CORS ì„¤ì •ì— `null` ë˜ëŠ” `http://localhost:5500` ë“±ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        console.warn("ê²½ê³ : HTML íŒŒì¼ì´ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ(file://)ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ë°±ì—”ë“œ ì—°ê²° ì‹œ CORS ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Live Serverë‚˜ ì›¹ ì„œë²„ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.");
        return `http://localhost:${backendPort}`;
    }
    // ê·¸ ì™¸ ì˜ˆìƒì¹˜ ëª»í•œ í”„ë¡œí† ì½œ (ì˜¤ë¥˜ ë°œìƒ ì‹œ)
    else {
        console.error("ì˜ˆìƒì¹˜ ëª»í•œ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œí† ì½œ:", protocol);
        return `http://localhost:${backendPort}`; // ê¸°ë³¸ fallback URL
    }
  };

  const BACKEND_URL = getBackendUrl(); // ë°±ì—”ë“œ URL ê²°ì •
  console.log(`í”„ë¡ íŠ¸ì—”ë“œ í˜„ì¬ URL: ${window.location.protocol}//${window.location.host}`);
  console.log(`ë°±ì—”ë“œ URLë¡œ ì„¤ì •ë¨: ${BACKEND_URL}`);

  // Socket.IO í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì‹œë„
  let socket;
  // 'io' ê°ì²´(Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬)ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
  if (typeof io !== 'undefined') {
    try {
      socket = io(BACKEND_URL); // ë°±ì—”ë“œ URLë¡œ Socket.IO ì—°ê²° ì‹œì‘
      socket.on('connect', () => { // ì—°ê²° ì„±ê³µ ì‹œ
        console.log('ğŸ”— Socket.IO ì—°ê²° ì„±ê³µ:', socket.id);
      });
      socket.on('connect_error', (err) => { // ì—°ê²° ì‹¤íŒ¨ ì‹œ (ë„¤íŠ¸ì›Œí¬, CORS ë“±)
        console.error('âŒ Socket.IO ì—°ê²° ì‹¤íŒ¨ (ì˜¤ë¥˜ ê°ì²´):', err);
        console.error('âŒ Socket.IO ì—°ê²° ì‹¤íŒ¨ (ë©”ì‹œì§€):', err.message);
        console.error('âŒ Socket.IO ì—°ê²° ëŒ€ìƒ URL:', BACKEND_URL);
        alert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€, í˜¹ì€ `BACKEND_URL` ì„¤ì • ë° CORS ì„¤ì •(íŠ¹íˆ `allowedOrigins`)ì´ ì˜¬ë°”ë¥¸ì§€ ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      });
      socket.on('disconnect', (reason) => { // ì—°ê²° ëŠê¹€ ì‹œ
        console.warn('ğŸ’” Socket.IO ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤:', reason);
        if (reason === 'io server disconnect') { // ì„œë²„ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°ì„ ëŠì€ ê²½ìš°
          alert('ì„œë²„ ì—°ê²°ì´ ëŠì–´ì ¸ ì¬ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤.');
          socket.connect(); // ì¬ì—°ê²° ì‹œë„
        }
      });
    } catch (e) {
      console.error("â›” Socket.IO ì´ˆê¸°í™” ì¤‘ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ: 'io' í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨!", e);
      alert('ì¹˜ëª…ì ì¸ ì˜¤ë¥˜: Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨! ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”. <script> íƒœê·¸ì˜ ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.');
    }
  } else {
    console.error("â›” Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬(io)ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <script src='http://localhost:3000/socket.io/socket.io.js'>ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    alert('ì¹˜ëª…ì ì¸ ì˜¤ë¥˜: Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤! ë°±ì—”ë“œ ì„œë²„ì™€ <script> íƒœê·¸ ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.');
  }


  // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ìš©) - ì‹¤ì œ ì¸ì¦ì€ ë°±ì—”ë“œì—ì„œ ë” ê°•ë ¥íˆ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.
  const ADMIN_PASSWORD = "admin1234";

  let allReservations = {}; // ì„œë²„ë¡œë¶€í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë˜ëŠ” ëª¨ë“  ì˜ˆì•½ ì •ë³´
  let adminSettings = {};   // ê´€ë¦¬ì ì„¤ì • ì •ë³´ (ì˜ˆì•½ ì‹œê°„)

  // DOM ìš”ì†Œ ì°¸ì¡° (HTML ìš”ì†Œë“¤ì„ JavaScriptì—ì„œ ì ‘ê·¼í•˜ê¸° ìœ„í•´)
  const loginPage = document.getElementById("loginPage");
  const loginForm = document.getElementById("loginForm");
  const roomNoInput = document.getElementById("roomNo");
  const userNameInput = document.getElementById("userName");
  const dormitorySelect = document.getElementById("dormitory");
  const roomError = document.getElementById("roomError");
  const nameError = document.getElementById("nameError");
  const dormError = document.getElementById("dormError");
  const adminLoginBtn = document.getElementById("adminLoginBtn");

  const floorSelectPage = document.getElementById("floorSelectPage");
  const floorSelect = document.getElementById("floorSelect");
  const floorNextBtn = document.getElementById("floorNextBtn");
  const backToLoginBtn = document.getElementById("backToLoginBtn");
  const welcomeText = document.getElementById("welcomeText");

  const seatMapPage = document.getElementById("seatMapPage");
  const seatMapContainer = document.getElementById("seatMap");
  const confirmBtn = document.getElementById("confirmBtn");
  const cancelSeatBtn = document.getElementById("cancelSeatBtn");
  const selectedDormTitle = document.getElementById("selectedDorm");
  const selectedFloorTitle = document.getElementById("selectedFloor");
  const reservationAvailabilityMessage = document.getElementById("reservationAvailabilityMessage");

  const adminLoginPage = document.getElementById("adminLoginPage");
  const adminLoginForm = document.getElementById("adminLoginForm");
  const adminPasswordInput = document.getElementById("adminPassword");
  const adminError = document.getElementById("adminError");

  const adminPage = document.getElementById("adminPage");
  const adminLogoutBtn = document.getElementById("adminLogoutBtn");
  const reservationListBody = document.getElementById("reservationListBody");

  const reservationTimeForm = document.getElementById("reservationTimeForm");
  const resStartTimeInput = document.getElementById("resStartTime");
  const resEndTimeInput = document.getElementById("resEndTime");
  const timeSettingMessage = document.getElementById("timeSettingMessage");

  let currentUser = null;    // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ (ë£¸ ë²ˆí˜¸, ì´ë¦„, ê¸°ìˆ™ì‚¬)
  let currentFloor = null;   // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¸µ
  let selectedSeat = null;   // ì‚¬ìš©ìê°€ í´ë¦­í•˜ì—¬ ì„ íƒí•œ ì¢Œì„ ë²ˆí˜¸

  const roomNoPattern = /^\d{3}í˜¸$/;    // ë£¸ ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ìš© ì •ê·œì‹ (ìˆ«ì 3ìë¦¬ + 'í˜¸')
  const koreanNamePattern = /^[ê°€-í£]{2,4}$/; // ì´ë¦„ ìœ íš¨ì„± ê²€ì‚¬ìš© ì •ê·œì‹ (í•œê¸€ 2~4ì)

  // ì¢Œì„ ë°°ì¹˜ë„ ë°°ì—´ ì •ì˜ (ì›ë˜ ë³´ë‚´ì£¼ì…¨ë˜ ë‚´ìš©)
  const seatLayouts = {
    "ê¿ˆë™": {
      "2": [
        [null,4,null,5,6,7,8,9,10,null,null,null,null],
        [null,3,null,null,null,null,null,null,null,11,null,null,null],
        [null,2,null,null,null,null,null,null,null,12,null,null,null],
        [null,1,null,null,null,null,null,null,null,null,null,null,null]
      ],
      "3": [
        [null,4,null,5,6,7,8,9,10,null,11,null,null,null],
        [null,3,null,null,null,null,null,null,null,null,12,null,null,null],
        [null,2,null,null,null,null,null,null,null,null,13,null,null,null],
        [null,1,null,null,null,null,null,null,null,null,14,null,null,null]
      ],
      "4": [
        [null,4,null,null,null,null,null,null,null,null],
        [null,3,null,null,5,7,null,null,null,null],
        [null,2,null,null,6,8,null,null,null,null],
        [null,1,null,null,null,null,null,null,null,null]
      ],
      "5": [
        [null,4,null,null,null,5,8,null,null,null],
        [null,3,null,null,null,6,9,null,null,null],
        [null,2,null,null,null,7,10,null,null,null],
        [null,1,null,null,null,null,null,null,null,null]
      ],
      "8": [
        [null,4,null,5,6,7,8,null,null,null,null,null,null],
        [null,3,null,null,null,null,null,null,null,null,null,null,null],
        [null,2,null,null,null,null,null,null,null,null,null,null,null],
        [null,1,null,null,null,null,null,null,null,null,null,null,null]
      ]
    },
    "ë¯¸ë˜ë™": {
      "2": [
        [null,null,null,null,null,5,6,7,8,9,10,11,12,null,null,null,null,null],
        [null,null,null,null,4,null,null,null,null,null,null,null,null,13,null,null,null,null],
        [null,null,null,null,3,null,null,null,null,null,null,null,null,14,null,null,null,null],
        [null,null,1,2,null,null,null,null,null,null,null,null,null,null,15,16,null,null],
        [null,17,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]
      ],
      "4-1": [
        [null,3,null,4,5,null,6,null,null,null],
        [null,2,null,null,null,7,null,null,null,null],
        [null,1,null,null,null,8,null,null,null,null]
      ],
      "4-2": [
        [null,4,null,5,6,7,8,9,10,11,12,null,13,null],
        [null,3,null,null,null,null,null,null,null,null,null,null,14,null],
        [null,2,null,null,null,null,null,null,null,null,null,null,null,null],
        [null,1,null,null,null,null,null,null,null,null,null,null,null,null]
      ]
    }
  };

  // --- ì„œë²„ì—ì„œ ë°ì´í„° ë¡œë”© í•¨ìˆ˜ (ì´ˆê¸° ë¡œë”© ë° ì¬ì—°ê²° ì‹œ ì‚¬ìš©) ---
  // HTTP ìš”ì²­ (REST API)ì„ í†µí•´ ì˜ˆì•½ ë°ì´í„°ë¥¼ ë°±ì—”ë“œë¡œë¶€í„° ê°€ì ¸ì˜´
  async function fetchAllReservations() {
    try {
      const response = await fetch(`${BACKEND_URL}/api/reservations`);
      if (!response.ok) throw new Error('ì˜ˆì•½ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + response.statusText);
      const data = await response.json();
      allReservations = {}; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
      data.forEach(r => { allReservations[r._id] = r; }); // MongoDBì˜ _idë¥¼ í‚¤ë¡œ ì‚¬ìš©í•˜ì—¬ ì €ì¥
      
      // ë°ì´í„° ì—…ë°ì´íŠ¸ í›„ í˜„ì¬ ë³´ì´ëŠ” UI ë™ê¸°í™” (ìƒˆë¡œê³ ì¹¨ ì—†ì´)
      if (!seatMapPage.classList.contains("hidden") && currentUser && currentFloor) {
        renderSeatMap(currentUser.dormitory, currentFloor);
      }
      if (!adminPage.classList.contains("hidden")) {
        loadAdminPage(); // ê´€ë¦¬ì í˜ì´ì§€ì˜ ì˜ˆì•½ ëª©ë¡ ê°±ì‹ 
      }
      return allReservations;
    } catch (error) {
      console.error('API í˜¸ì¶œ ì—ëŸ¬: ì˜ˆì•½ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
      alert('ì˜ˆì•½ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„(`' + BACKEND_URL + '`)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      return {};
    }
  }

  // ê´€ë¦¬ì ì„¤ì • ë°ì´í„°ë„ HTTP ìš”ì²­ìœ¼ë¡œ ê°€ì ¸ì˜´
  async function fetchAdminSettings() {
    try {
      const response = await fetch(`${BACKEND_URL}/api/admin-settings`);
      if (!response.ok) throw new Error('ê´€ë¦¬ì ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + response.statusText);
      adminSettings = await response.json(); // ê´€ë¦¬ì ì„¤ì • ë°ì´í„° ì—…ë°ì´íŠ¸
      
      // ë°ì´í„° ì—…ë°ì´íŠ¸ í›„ í˜„ì¬ ë³´ì´ëŠ” UI ë™ê¸°í™”
      if (!adminPage.classList.contains("hidden")) { loadAdminPage(); }
      updateReservationAvailability(); // ì˜ˆì•½ ê°€ëŠ¥ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
      if (!seatMapPage.classList.contains("hidden") && currentUser && currentFloor) {
        renderSeatMap(currentUser.dormitory, currentFloor);
      }
      return adminSettings;
    } catch (error) {
      console.error('API í˜¸ì¶œ ì—ëŸ¬: ê´€ë¦¬ì ì„¤ì •ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
      alert('ê´€ë¦¬ì ì„¤ì •ì„ ê°€ì ¸ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„(`' + BACKEND_URL + '`)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      return { reservationStartTime: null, reservationEndTime: null };
    }
  }

  // --- Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë°±ì—”ë“œë¡œë¶€í„°ì˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì²˜ë¦¬) ---
  // Socket.IO ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ëœ ê²½ìš°ì—ë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  if (socket) {
    // ì˜ˆì•½ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŒì„ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ 
    socket.on('reservationsUpdated', updated => {
      console.log('ğŸ”— ì˜ˆì•½ ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ ');
      allReservations = {};
      updated.forEach(r => { allReservations[r._id] = r; });
      
      // UI ì¦‰ì‹œ ê°±ì‹  (ìƒˆë¡œê³ ì¹¨ ì—†ì´)
      if (!seatMapPage.classList.contains('hidden') && currentUser && currentFloor) {
        renderSeatMap(currentUser.dormitory, currentFloor);
      }
      if (!adminPage.classList.contains('hidden')) {
        loadAdminPage(); // ê´€ë¦¬ì í˜ì´ì§€ì˜ ì˜ˆì•½ ëª©ë¡ ê°±ì‹ 
      }
    });

    // ê´€ë¦¬ì ì„¤ì •(ì˜ˆì•½ ì‹œê°„)ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŒì„ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ 
    socket.on('settingsUpdated', updated => {
      console.log('ğŸ”— ê´€ë¦¬ì ì„¤ì • ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ ');
      adminSettings = updated;
      
      // UI ì¦‰ì‹œ ê°±ì‹  (ìƒˆë¡œê³ ì¹¨ ì—†ì´)
      if (!adminPage.classList.contains('hidden')) { loadAdminPage(); }
      updateReservationAvailability(); // ì˜ˆì•½ ê°€ëŠ¥ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
      if (!seatMapPage.classList.contains('hidden') && currentUser && currentFloor) {
        renderSeatMap(currentUser.dormitory, currentFloor);
      }
    });
  }


  // --- ì‹œê°„ ê´€ë¦¬ ë° ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ---
  // í˜„ì¬ ì‹œê°„ì´ ê´€ë¦¬ìê°€ ì„¤ì •í•œ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
  function isReservationTimeAllowed() {
    const now = new Date();
    const settings = adminSettings;

    if (!settings.reservationStartTime || !settings.reservationEndTime) {
      return { allowed: false, message: "ê´€ë¦¬ìê°€ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì„ ì„¤ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." };
    }

    const startTime = new Date(settings.reservationStartTime);
    const endTime = new Date(settings.reservationEndTime);

    if (now >= startTime && now <= endTime) {
      return { allowed: true, message: `ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì…ë‹ˆë‹¤. (${formatDate(startTime)} ~ ${formatDate(endTime)})` };
    } else {
      return { allowed: false, message: `í˜„ì¬ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤. (${formatDate(startTime)} ~ ${formatDate(endTime)})` };
    }
  }

  // Date ê°ì²´ë¥¼ 'MM-DD HH:mm' í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜ (ì˜ˆ: 07-25 14:30)
  function formatDate(date) {
    const pad = (num) => num < 10 ? '0' + num : num; // í•œ ìë¦¬ ìˆ«ìë¥¼ ë‘ ìë¦¬ë¡œ ë§Œë“¦ (ì˜ˆ: 5 -> 05)
    const month = pad(date.getMonth() + 1); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ 1ì„ ë”í•¨
    const day = pad(date.getDate());
    const hours = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    return `${month}-${day} ${hours}:${minutes}`;
  }


  // --- UI ì „í™˜ í•¨ìˆ˜ ---
  // í˜ì´ì§€(section) ê°„ì˜ ì „í™˜ì„ ì²˜ë¦¬ (ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°)
  function showSection(section) {
    // ëª¨ë“  í˜ì´ì§€ë¥¼ ìˆ¨ê¹€
    [loginPage, floorSelectPage, seatMapPage, adminLoginPage, adminPage]
      .forEach(s => s.classList.add("hidden"));
    // ì„ íƒëœ í˜ì´ì§€ë¥¼ ë³´ì´ê²Œ í•¨
    section.classList.remove("hidden");
  }

  // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
  // ë¡œê·¸ì¸ í¼ ì œì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  loginForm.addEventListener("submit", async e => {
    e.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€
    clearErrors(); // ê¸°ì¡´ ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”

    const roomNo = roomNoInput.value.trim();
    const name = userNameInput.value.trim();
    const dormitory = dormitorySelect.value;

    let valid = true; // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ í”Œë˜ê·¸
    if (!roomNoPattern.test(roomNo)) {
      roomError.textContent = "ë£¸ ë²ˆí˜¸ëŠ” 000í˜¸ í˜•ì‹(ìˆ«ì 3ìë¦¬ + í˜¸)ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      valid = false;
    }
    if (!koreanNamePattern.test(name)) {
      nameError.textContent = "ì´ë¦„ì€ í•œê¸€ 2~4ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
      valid = false;
    }
    if (!dormitory) {
      dormError.textContent = "ê¸°ìˆ™ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
      valid = false;
    }
    if (!valid) return; // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ

    // ì‚¬ìš©ì ì¤‘ë³µ ì˜ˆì•½ í™•ì¸ (allReservationsëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ìµœì‹ í™”ëœ ë°ì´í„°)
    const hasReservation = Object.values(allReservations).some(
      r => r.roomNo === roomNo && r.name === name
    );
    if (hasReservation) {
      // ì´ë¯¸ ì˜ˆì•½í•œ ì‚¬ìš©ìëŠ” ë°”ë¡œ ì¢Œì„ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™ì‹œì¼œ ìì‹ ì˜ ì¢Œì„ì„ ë³´ì—¬ì¤Œ
      const existingReservation = Object.values(allReservations).find(r => r.roomNo === roomNo && r.name === name);
      currentUser = { roomNo, name, dormitory }; // í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
      currentFloor = existingReservation.floor;   // ê¸°ì¡´ ì˜ˆì•½ì˜ ì¸µ ì„¤ì •
      selectedSeat = existingReservation.seat;     // ê¸°ì¡´ ì˜ˆì•½ì˜ ì¢Œì„ ì„¤ì •

      setFloorOptions(dormitory);        // ì¸µ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì„¤ì •
      floorSelect.value = currentFloor;  // ì¸µ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ê¸°ì¡´ ì˜ˆì•½ ì¸µ ë¯¸ë¦¬ ì„ íƒ

      welcomeText.textContent = `${name}ë‹˜, ${dormitory} ê¸°ìˆ™ì‚¬ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.`;
      selectedDormTitle.textContent = currentUser.dormitory;
      selectedFloorTitle.textContent = currentFloor;
      renderSeatMap(currentUser.dormitory, currentFloor); // ì¢Œì„ ë°°ì¹˜ë„ ë Œë”ë§
      updateReservationAvailability();   // ì˜ˆì•½ ê°€ëŠ¥ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
      showSection(seatMapPage);          // ì¢Œì„ ì„ íƒ í˜ì´ì§€ë¡œ ì „í™˜

    } else {
      // ì²˜ìŒ ì˜ˆì•½í•˜ëŠ” ì‚¬ìš©ì
      currentUser = { roomNo, name, dormitory };
      setFloorOptions(dormitory);
      welcomeText.textContent = `${name}ë‹˜, ${dormitory} ê¸°ìˆ™ì‚¬ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.`;
      showSection(floorSelectPage);      // ì¸µ ì„ íƒ í˜ì´ì§€ë¡œ ì „í™˜
    }
  });

  // 'ë’¤ë¡œê°€ê¸°' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°)
  backToLoginBtn.addEventListener("click", () => {
    currentUser = null; currentFloor = null; selectedSeat = null; // ìƒíƒœ ì´ˆê¸°í™”
    loginForm.reset(); // ë¡œê·¸ì¸ í¼ ì´ˆê¸°í™”
    showSection(loginPage); // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì „í™˜
  });

  // ì¸µ ì„ íƒ í›„ 'ì¢Œì„ ì„ íƒìœ¼ë¡œ' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  floorNextBtn.addEventListener("click", () => {
    const selected = floorSelect.value;
    if (!selected) {
      alert("ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    currentFloor = selected; // ì„ íƒëœ ì¸µ ì„¤ì •
    selectedDormTitle.textContent = currentUser.dormitory; // í™”ë©´ì— í‘œì‹œ
    selectedFloorTitle.textContent = currentFloor; // í™”ë©´ì— í‘œì‹œ
    selectedSeat = null; // ì¸µ ë³€ê²½ ì‹œ ì„ íƒ ì¢Œì„ ì´ˆê¸°í™”
    confirmBtn.disabled = true; // ì¢Œì„ ì„ íƒ ì „ê¹Œì§€ 'ì˜ˆì•½ í™•ì •' ë²„íŠ¼ ë¹„í™œì„±í™”
    renderSeatMap(currentUser.dormitory, currentFloor); // ì¢Œì„ ë°°ì¹˜ë„ ë Œë”ë§
    updateReservationAvailability(); // ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
    showSection(seatMapPage); // ì¢Œì„ ì„ íƒ í˜ì´ì§€ë¡œ ì „í™˜
  });

  // ì¢Œì„ ì„ íƒ í˜ì´ì§€ì—ì„œ 'ì·¨ì†Œ ë° ë’¤ë¡œê°€ê¸°' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  cancelSeatBtn.addEventListener("click", () => {
    selectedSeat = null; // ì„ íƒëœ ì¢Œì„ ì´ˆê¸°í™”
    confirmBtn.disabled = true; // 'ì˜ˆì•½ í™•ì •' ë²„íŠ¼ ë¹„í™œì„±í™”
    showSection(floorSelectPage); // ì¸µ ì„ íƒ í˜ì´ì§€ë¡œ ì „í™˜
  });

  // ê´€ë¦¬ì ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  adminLoginBtn.addEventListener("click", () => {
    showSection(adminLoginPage); // ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì „í™˜
    adminLoginForm.reset();      // ê´€ë¦¬ì ë¡œê·¸ì¸ í¼ ì´ˆê¸°í™”
    adminError.textContent = ""; // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
  });

  // ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ 'ë’¤ë¡œê°€ê¸°' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  document.getElementById("adminLoginBackBtn").addEventListener("click", () => {
    showSection(loginPage);      // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì „í™˜
    adminPasswordInput.value = ""; // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    adminError.textContent = ""; // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
  });

  // ê´€ë¦¬ì ë¡œê·¸ì¸ í¼ ì œì¶œ ì´ë²¤íŠ¸
  adminLoginForm.addEventListener("submit", async e => {
    e.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€
    const pw = adminPasswordInput.value.trim(); // ë¹„ë°€ë²ˆí˜¸ ê°€ì ¸ì˜´
    if (pw === ADMIN_PASSWORD) { // í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
      showSection(adminPage);    // ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì „í™˜
      await loadAdminPage();     // ê´€ë¦¬ì í˜ì´ì§€ ë°ì´í„° (ì˜ˆì•½ í˜„í™©, ì‹œê°„ ì„¤ì •) ë¡œë“œ
    } else {
      adminError.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."; // ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    }
  });

  // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ 'ë¡œê·¸ì•„ì›ƒ' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  adminLogoutBtn.addEventListener("click", () => {
    showSection(loginPage);      // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì „í™˜
    adminPasswordInput.value = ""; // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    adminError.textContent = ""; // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
  });

  // --- ì¸µ ì„ íƒ ë° ì¢Œì„ ë Œë”ë§ ---
  // ë“œë¡­ë‹¤ìš´ì— ê¸°ìˆ™ì‚¬ë³„ ì¸µ ì˜µì…˜ ì„¤ì •
  function setFloorOptions(dormitory) {
    floorSelect.innerHTML = '<option value="" disabled selected>ì¸µ ì„ íƒ</option>'; // ì´ˆê¸° ì˜µì…˜ ì„¤ì •
    const floors = Object.keys(seatLayouts[dormitory]).sort((a,b) => {
      // ì¸µ ë²ˆí˜¸ ì •ë ¬ (ì˜ˆ: 4-1ì¸µê³¼ ê°™ì€ í˜•ì‹ë„ ìˆ«ì ë¶€ë¶„ìœ¼ë¡œ ì •ë ¬)
      const partA = a.split("-")[0];
      const partB = b.split("-")[0];
      return Number(partA) - Number(partB);
    });
    floors.forEach(floor => {
      const option = document.createElement("option");
      option.value = floor;
      option.textContent = floor.includes("-") ? floor.replace("-", "ì¸µ-") : floor + "ì¸µ"; // '4-1' -> '4ì¸µ-1'
      floorSelect.appendChild(option);
    });
  }

  // ì¢Œì„ ë°°ì¹˜ë„ ìƒì„± ë° ë Œë”ë§
  function renderSeatMap(dorm, floor) {
    seatMapContainer.innerHTML = ""; // ê¸°ì¡´ ì¢Œì„ ë°°ì¹˜ë„ ì´ˆê¸°í™”
    const layout = seatLayouts[dorm][floor]; // ì„ íƒëœ ê¸°ìˆ™ì‚¬ì™€ ì¸µì˜ ì¢Œì„ ë°°ì¹˜ ë°ì´í„° ê°€ì ¸ì˜´
    if (!layout) {
      seatMapContainer.textContent = "í•´ë‹¹ ì¸µì˜ ì¢Œì„ ë°°ì¹˜ë„ê°€ ì—†ìŠµë‹ˆë‹¤.";
      return;
    }
    // ê°€ì¥ ê¸´ í–‰ì˜ ê¸¸ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì •
    const maxCols = Math.max(...layout.map(r => r.length));
    seatMapContainer.style.gridTemplateColumns = `repeat(${maxCols}, 44px)`;

    const reservationAllowed = isReservationTimeAllowed().allowed; // í˜„ì¬ ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ì¸ì§€ í™•ì¸

    layout.forEach(row => { // ê° í–‰ ìˆœíšŒ
      row.forEach(seatNum => { // ê° ì¢Œì„ ìˆœíšŒ
        const btn = document.createElement("button"); // ì¢Œì„ ë²„íŠ¼ ìƒì„±
        btn.type = "button";

        if (seatNum === null) {
          // nullì€ ë¹ˆ ê³µê°„ì´ë¯€ë¡œ íˆ¬ëª…í•˜ê²Œ ì²˜ë¦¬
          btn.classList.add("seat-btn", "empty");
          btn.textContent = "";
        } else {
          btn.classList.add("seat-btn");
          btn.textContent = seatNum; // ì¢Œì„ ë²ˆí˜¸ í‘œì‹œ

          // allReservations(ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ìµœì‹  ì˜ˆì•½ ë°ì´í„°)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¢Œì„ ì˜ˆì•½ ì—¬ë¶€ í™•ì¸
          const booked = Object.values(allReservations).find(r => r.dormitory === dorm && r.floor === floor && r.seat === seatNum);
          if (booked) {
            // ì´ë¯¸ ì˜ˆì•½ëœ ì¢Œì„ (ë‹¤ë¥¸ ì‚¬ìš©ì)
            btn.classList.add("booked");
            btn.disabled = true; // ë¹„í™œì„±í™”í•˜ì—¬ í´ë¦­ ë¶ˆê°€
            btn.title = `${booked.name}ë‹˜ ì˜ˆì•½ë¨`; // íˆ´íŒì— ì˜ˆì•½ì ì´ë¦„ í‘œì‹œ
            // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì˜ˆì•½ì´ë©´ 'mine' í´ë˜ìŠ¤ ì¶”ê°€ ë° ì¬í™œì„±í™” (ìë¦¬ ë³€ê²½ ëª©ì )
            if (currentUser && booked.roomNo === currentUser.roomNo && booked.name === currentUser.name) {
              btn.classList.add("mine");
              btn.disabled = false; // ìì‹ ì˜ ì˜ˆì•½ ì¢Œì„ì€ ë‹¤ì‹œ í™œì„±í™”
            }
          } else {
            // ì˜ˆì•½ë˜ì§€ ì•Šì€ ì¢Œì„: ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ì—¬ë¶€ì— ë”°ë¼ í™œì„±í™”/ë¹„í™œì„±í™”
            btn.disabled = !reservationAllowed;
            btn.title = reservationAllowed ? "ì˜ˆì•½ ê°€ëŠ¥ ìë¦¬" : "ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.";
            btn.onclick = () => {
              if (reservationAllowed) { // ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ì¸ ê²½ìš°ì—ë§Œ ì¢Œì„ ì„ íƒ ê°€ëŠ¥
                selectedSeat = seatNum; // ì„ íƒëœ ì¢Œì„ ì €ì¥
                confirmBtn.disabled = false; // 'ì˜ˆì•½ í™•ì •' ë²„íŠ¼ í™œì„±í™”
                highlightSelectedSeat(); // ì„ íƒëœ ì¢Œì„ ì‹œê°ì ìœ¼ë¡œ ê°•ì¡°
              }
            };
          }
        }
        seatMapContainer.appendChild(btn); // ìƒì„±ëœ ë²„íŠ¼ì„ ë°°ì¹˜ë„ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
      });
    });
    highlightSelectedSeat(); // ì¢Œì„ ë°°ì¹˜ë„ ë Œë”ë§ í›„ í˜„ì¬ ì„ íƒëœ ì¢Œì„ì´ ìˆë‹¤ë©´ ê°•ì¡° (ì£¼ë¡œ Socket.IO ì—…ë°ì´íŠ¸ í›„ í˜¸ì¶œë  ë•Œ í•„ìš”)
  }

  // ì„ íƒëœ ì¢Œì„ì„ ì‹œê°ì ìœ¼ë¡œ ê°•ì¡° (ë‹¤ë¥¸ ì¢Œì„ì˜ ê°•ì¡°ëŠ” ì œê±°)
  function highlightSelectedSeat() {
    const buttons = seatMapContainer.querySelectorAll("button.seat-btn"); // ëª¨ë“  ì¢Œì„ ë²„íŠ¼ ê°€ì ¸ì˜´
    buttons.forEach(btn => {
      if (parseInt(btn.textContent) === selectedSeat) {
        btn.classList.add("mine"); // ì„ íƒëœ ì¢Œì„ì— 'mine' í´ë˜ìŠ¤ ì¶”ê°€
      } else {
        btn.classList.remove("mine"); // ë‹¤ë¥¸ ì¢Œì„ì—ì„œ 'mine' í´ë˜ìŠ¤ ì œê±°
      }
    });
  }

  // ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ ë©”ì‹œì§€ ë° 'ì˜ˆì•½ í™•ì •' ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
  function updateReservationAvailability() {
    const status = isReservationTimeAllowed(); // ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì¸ì§€ í™•ì¸
    reservationAvailabilityMessage.textContent = status.message; // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
    if (status.allowed) {
      reservationAvailabilityMessage.classList.add("available"); // ë…¹ìƒ‰ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
      confirmBtn.disabled = (selectedSeat === null); // ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ì´ê³  ì¢Œì„ì´ ì„ íƒë˜ì–´ì•¼ ë²„íŠ¼ í™œì„±í™”
    } else {
      reservationAvailabilityMessage.classList.remove("available"); // ë¹¨ê°„ìƒ‰ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
      confirmBtn.disabled = true; // ì˜ˆì•½ ë¶ˆê°€ëŠ¥í•œ ì‹œê°„ì´ë¼ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
    }
  }

  // --- ì˜ˆì•½ í™•ì • ì²˜ë¦¬ ---
  confirmBtn.addEventListener("click", async () => {
    if (!selectedSeat) { // ì¢Œì„ì´ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê²½ê³ 
      alert("ì¢Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    // ìµœì¢… í™•ì • ì „ì— ë‹¤ì‹œ í•œë²ˆ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ í™•ì¸ (ë™ì‹œì„± ë¬¸ì œ ëŒ€ë¹„)
    if (!isReservationTimeAllowed().allowed) {
      alert("ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹ˆë¯€ë¡œ ì˜ˆì•½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      updateReservationAvailability(); // UI ì—…ë°ì´íŠ¸
      return;
    }

    try {
      // 1. ê¸°ì¡´ ì˜ˆì•½ ì‚­ì œ ì‹œë„: ì‚¬ìš©ìê°€ ìë¦¬ë¥¼ ë³€ê²½í•˜ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ë°±ì—”ë“œì—ì„œ í•´ë‹¹ ì‚¬ìš©ìì˜ ê¸°ì¡´ ì˜ˆì•½ì´ ìˆë‹¤ë©´ ì‚­ì œ
      const deleteResponse = await fetch(`${BACKEND_URL}/api/reservations/user/${currentUser.roomNo}/${currentUser.name}`, {
        method: 'DELETE',
      });
      if (!deleteResponse.ok) console.warn("ê¸°ì¡´ ì˜ˆì•½ ì‚­ì œ API ì‘ë‹µ ë¬¸ì œ (ê²½ê³ ):", deleteResponse.status);
      // ì„œë²„ì—ì„œ ì´ ì‚­ì œ ìš”ì²­ ì²˜ë¦¬ í›„ Socket.IOë¥¼ í†µí•´ 'reservationsUpdated'ë¥¼ emití•˜ë¯€ë¡œ
      // í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” ë³„ë„ì˜ `allReservations` ë¡œë”©ì€ ë¶ˆí•„ìš”.

      // 2. ìƒˆ ì˜ˆì•½ ìƒì„± ìš”ì²­
      const response = await fetch(`${BACKEND_URL}/api/reservations`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }, // JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
        body: JSON.stringify({ // JavaScript ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
          roomNo: currentUser.roomNo,
          name: currentUser.name,
          dormitory: currentUser.dormitory,
          floor: currentFloor,
          seat: selectedSeat
        })
      });

      const result = await response.json(); // ë°±ì—”ë“œì—ì„œ ë³´ë‚¸ ì‘ë‹µ(ë©”ì‹œì§€ í¬í•¨)ì„ JSONìœ¼ë¡œ íŒŒì‹±

      if (response.ok) { // HTTP ìƒíƒœ ì½”ë“œê°€ 200ë²ˆëŒ€ì¸ ê²½ìš° (ì˜ˆì•½ ì„±ê³µ)
        alert(`ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n${currentUser.dormitory} ${currentFloor}ì¸µ ${selectedSeat}ë²ˆ ìë¦¬`);
        // ì˜ˆì•½ ì„±ê³µ í›„ í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³µê·€
        currentUser = null;
        currentFloor = null;
        selectedSeat = null;
        loginForm.reset(); // ë¡œê·¸ì¸ í¼ ì´ˆê¸°í™”
        showSection(loginPage); // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì „í™˜
      } else {
        // HTTP ìƒíƒœ ì½”ë“œê°€ 200ë²ˆëŒ€ê°€ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: ë°±ì—”ë“œì—ì„œ ì¤‘ë³µ ì˜ˆì•½ ë“±ìœ¼ë¡œ ê±°ì ˆ)
        alert(`ì˜ˆì•½ ì‹¤íŒ¨: ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`); // ë°±ì—”ë“œ ë©”ì‹œì§€ ë˜ëŠ” ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        // ì‹¤íŒ¨ í›„ ìµœì‹  ìƒíƒœ ë°˜ì˜ì„ ìœ„í•´ ì¢Œì„ ë§µ ë‹¤ì‹œ ë Œë”ë§ (allReservationsëŠ” Socket.IOë¡œ ìµœì‹ í™”ë¨)
        if (currentUser && currentFloor) { renderSeatMap(currentUser.dormitory, currentFloor); }
      }
    } catch (error) {
      console.error("ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      alert("ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }
  });

  // --- ê´€ë¦¬ì í˜ì´ì§€ ë¡œë”© ë° ì˜ˆì•½/ì‹œê°„ ì„¤ì • ëª©ë¡ ì¶œë ¥ ---
  async function loadAdminPage() {
    const reservations = Object.values(allReservations); // allReservationsëŠ” Socket.IO ë˜ëŠ” ì´ˆê¸° fetchë¡œ ìµœì‹ í™”ë¨
    reservationListBody.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
    if (reservations.length === 0) {
      reservationListBody.innerHTML = '<tr><td colspan="6">ë“±ë¡ëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    } else {
      reservations.forEach(r => {
        const tr = document.createElement("tr"); // í…Œì´ë¸” í–‰ ìƒì„±
        tr.innerHTML = `
          <td>${r.name}</td>
          <td>${r.roomNo}</td>
          <td>${r.dormitory}</td>
          <td>${r.floor}</td>
          <td>${r.seat}</td>
          <td><button type="button" class="cancel-btn" data-id="${r._id}">ì·¨ì†Œ</button></td>
        `; // ì˜ˆì•½ ì •ë³´ ë° ì·¨ì†Œ ë²„íŠ¼
        reservationListBody.appendChild(tr); // í…Œì´ë¸” ë°”ë””ì— í–‰ ì¶”ê°€
      });
    }

    // ê° 'ì·¨ì†Œ' ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll(".cancel-btn").forEach(btn => {
      btn.onclick = async () => {
        const reservationId = btn.getAttribute("data-id"); // ì˜ˆì•½ ê³ ìœ  ID ê°€ì ¸ì˜´
        if (confirm("ì •ë§ ì´ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { // ì‚¬ìš©ì í™•ì¸
          await deleteReservation(reservationId); // ì˜ˆì•½ ì‚­ì œ ìš”ì²­
        }
      };
    });

    // ê´€ë¦¬ì ì„¤ì • (ì˜ˆì•½ ì‹œê°„) ë¡œë“œ (adminSettingsëŠ” Socket.IO ë˜ëŠ” ì´ˆê¸° fetchë¡œ ìµœì‹ í™”ë¨)
    const currentSettings = adminSettings;
    if (currentSettings.reservationStartTime) {
      resStartTimeInput.value = new Date(currentSettings.reservationStartTime).toISOString().slice(0, 16); // ISO ë¬¸ìì—´ì„ datetime-local í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    } else { resStartTimeInput.value = ''; }
    if (currentSettings.reservationEndTime) {
      resEndTimeInput.value = new Date(currentSettings.reservationEndTime).toISOString().slice(0, 16);
    } else { resEndTimeInput.value = ''; }
    timeSettingMessage.textContent = ""; // ë©”ì‹œì§€ ì´ˆê¸°í™”
    timeSettingMessage.style.color = "initial"; // ë©”ì‹œì§€ ìƒ‰ìƒ ì´ˆê¸°í™”
  }

  // --- ì˜ˆì•½ ì·¨ì†Œ í•¨ìˆ˜ (ê´€ë¦¬ììš©) ---
  async function deleteReservation(reservationId) {
    try {
      const response = await fetch(`${BACKEND_URL}/api/reservations/${reservationId}`, {
        method: 'DELETE', // DELETE ìš”ì²­
      });
      const result = await response.json(); // ì‘ë‹µ íŒŒì‹±
      if (!response.ok) { // ì‹¤íŒ¨ ì‹œ
        alert(`ì˜ˆì•½ ì·¨ì†Œ ì‹¤íŒ¨: ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
      } else { // ì„±ê³µ ì‹œ
        alert("ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        // ì„œë²„ì—ì„œ Socket.IOë¥¼ í†µí•´ 'reservationsUpdated'ë¥¼ emití•˜ë¯€ë¡œ ë³„ë„ ë¡œë”©ì€ ë¶ˆí•„ìš”
      }
    } catch (error) {
      console.error("ì˜ˆì•½ ì‚­ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      alert("ì˜ˆì•½ ì‚­ì œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }
  }

  // --- ê´€ë¦¬ì ì˜ˆì•½ ì‹œê°„ ì„¤ì • í¼ ì œì¶œ ì²˜ë¦¬ ---
  reservationTimeForm.addEventListener("submit", async (e) => {
    e.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë°©ì§€
    const startTime = resStartTimeInput.value;
    const endTime = resEndTimeInput.value;

    if (!startTime || !endTime) { // ì‹œì‘/ì¢…ë£Œ ì‹œê°„ í•„ìˆ˜ ì…ë ¥ ê²€ì‚¬
      timeSettingMessage.textContent = "ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ëª¨ë‘ ì„¤ì •í•´ì£¼ì„¸ìš”.";
      timeSettingMessage.style.color = "red";
      return;
    }

    const startDateObj = new Date(startTime);
    const endDateObj = new Date(endTime);

    if (endDateObj <= startDateObj) { // ì¢…ë£Œ ì‹œê°„ì´ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•¨
      timeSettingMessage.textContent = "ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.";
      timeSettingMessage.style.color = "red";
      return;
    }

    try {
      const response = await fetch(`${BACKEND_URL}/api/admin-settings`, {
        method: 'PUT', // PUT ìš”ì²­ (ì—…ë°ì´íŠ¸)
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ // JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
          reservationStartTime: startDateObj.toISOString(), // ISO String í˜•ì‹ìœ¼ë¡œ ì‹œê°„ ì „ì†¡ (DB ì €ì¥ìš©)
          reservationEndTime: endDateObj.toISOString()
        })
      });

      const result = await response.json();
      if (!response.ok) { // ì‹¤íŒ¨ ì‹œ
        timeSettingMessage.textContent = `ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
        timeSettingMessage.style.color = "red";
      } else { // ì„±ê³µ ì‹œ
        timeSettingMessage.textContent = "ì˜ˆì•½ ì‹œê°„ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.";
        timeSettingMessage.style.color = "green";
        // ì„œë²„ì—ì„œ Socket.IOë¥¼ í†µí•´ 'settingsUpdated'ë¥¼ emití•˜ë¯€ë¡œ ë³„ë„ ë¡œë”©ì€ ë¶ˆí•„ìš”
      }
    } catch (error) {
      console.error("ì‹œê°„ ì„¤ì • ì €ì¥ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      timeSettingMessage.textContent = "ì‹œê°„ ì„¤ì • ì €ì¥ ì¤‘ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
      timeSettingMessage.style.color = "red";
    }
  });

  // --- ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™” ---
  function clearErrors() {
    roomError.textContent = "";
    nameError.textContent = "";
    dormError.textContent = "";
  }

  // ì´ˆê¸° í˜ì´ì§€ ë¡œë”© ì‹œ ë™ì‘
  // ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ì •ì˜í•˜ì—¬ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ UIë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
  (async () => {
    // ëª¨ë“  ì˜ˆì•½ ì •ë³´ì™€ ê´€ë¦¬ì ì„¤ì • ì •ë³´ë¥¼ ë¯¸ë¦¬ ë¡œë“œ (ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•¨)
    await fetchAllReservations();
    await fetchAdminSettings();

    showSection(loginPage); // ëª¨ë“  ë°ì´í„° ë¡œë“œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ
  })();
})();
    </script>
    </body>
    </html>